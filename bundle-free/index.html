<!DOCTYPE html>
<html lang="en">
<title>Alper Kilci</title>

<script type="module">
  import { html, Component, render, useState, useEffect, useRef } from 'https://unpkg.com/htm/preact/standalone.module.js';

  const DateTimeDisplay = () => {
    const [currentTime, setCurrentTime] = useState(new Date());

    const updateCurrentTime = () => {
      setCurrentTime(new Date());
    };

    useEffect(() => {
      setInterval(updateCurrentTime, 1000);

      return () => {
        clearInterval(updateCurrentTime);
      };
    });

    const date = currentTime.toDateString().toUpperCase().slice(0, -5);
    const time = currentTime.toLocaleTimeString();

    return html`
    <span class="datetime">
      <span class="date">${date}</span>
      <span class="time">${time}</span>
    </span>
  `;
  };

  const useDebounce = (value, timeout) => {
    const [state, setState] = useState(value)

    useEffect(() => {
      const handler = setTimeout(() => setState(value), timeout)

      return () => clearTimeout(handler)
    }, [value, timeout])

    return state
  }

  const PageHeader = ({ pageNumber }) => {
    return html`
      <div class="page-header">
        <span class="page-number">P${pageNumber}</span>
        <span class="title">${"title"}</span>
        <${DateTimeDisplay} />
      </div>
  `;
  };

  const App = () => {
    const VALID_PAGES = ['100', '200', '300'];
    const NAVIGATION_TIMEOUT = 1000;

    const typingPageNumber = useRef(false);
    const [displayedPageNumber, setDisplayedPageNumber] = useState("100")

    const [pageNumber, setPageNumber] = useState("100")

    const isPageValid = (pn) => !!VALID_PAGES.find(page => page === pn);

    const debouncedInput = useDebounce(displayedPageNumber, NAVIGATION_TIMEOUT)

    useEffect(() => {
      console.log(displayedPageNumber)
      typingPageNumber.current = false;
    }, [debouncedInput])


    const navigatePage = (p) => {
      typingPageNumber.current = false;

      if (isPageValid(p)) {
        // this.$router.push({ path: p });
      } else {
        setDisplayedPageNumber("100");
      }
    }

    const handleKeydown = (e) => {
      if ((e.keyCode >= 48 && e.keyCode <= 57) || (e.keyCode >= 96 && e.keyCode <= 105)) {
        if (typingPageNumber.current) {
          setDisplayedPageNumber(`${displayedPageNumber}${e.key}`);
        } else {
          setDisplayedPageNumber(e.key);
          typingPageNumber.current = true;
        }
      }
    };

    useEffect(() => {
      document.addEventListener('keydown', handleKeydown);

      return () => { }
      document.removeEventListener('keydown', handleKeydown);
    }, [])

    return html`
      <div class="app">
        <div class="page-container">
          <${PageHeader} pageNumber=${displayedPageNumber} }} />

        </div>
        <div class="page__footer">
          Click or type page number to navigate
        </div
      </div>
    `;
  };
  render(html`<${App} page="All" />`, document.body);
</script>

</html>